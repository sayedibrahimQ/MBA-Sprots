{% load i18n %}

<div class="questions-answers-section">
    <h5 class="mb-4">{% trans "Questions & Answers" %}</h5>

    {% if questions_answers %}
        {% for qa in questions_answers %}
        <div class="qa-item border-bottom border-secondary-subtle pb-3 mb-3">
            <p class="mb-1">
                <strong class="text-warning">{% trans "Q:" %}</strong> 
                <span class="text-light">{{ qa.text }}</span>
            </p>
            <small class="text-muted d-block mb-2">
                {% trans "Asked by" %} {{ qa.user_name_display|default:qa.customer.get_full_name|default:_("Anonymous") }} {% trans "on" %} {{ qa.created_at|date:"d M Y" }}
            </small>
            
            {% if qa.is_answered and qa.answer_text %}
            <div class="ms-md-4 ps-2 border-start border-warning border-2">
                <p class="mb-1">
                    <strong class="text-success">{% trans "A:" %}</strong> 
                    <span class="text-white-75">{{ qa.answer_text|linebreaksbr }}</span>
                </p>
                <small class="text-muted">
                    {% trans "Answered" %} {% if qa.answered_by %}{% trans "by Admin" %}<!-- {{ qa.answered_by.get_full_name|default:qa.answered_by.username }} --> {% endif %} {% trans "on" %} {{ qa.answered_at|date:"d M Y" }}
                </small>
            </div>
            {% else %}
            <p class="ms-md-4 ps-2 text-white-50"><em>{% trans "Awaiting answer..." %}</em></p>
            {% endif %}
        </div>
        {% endfor %}
    {% else %}
        <p class="text-white-50">{% trans "No questions have been asked about this product yet. Be the first!" %}</p>
    {% endif %}

    <div class="question-form-container mt-4 pt-3">
        <h6 class="text-light mb-3">{% trans "Ask a Question" %}</h6>
        <form method="post" action="{% url 'ecommerce:add_question' product.id %}" class="needs-validation" novalidate>
            {% csrf_token %}
            <div class="mb-3">
                <label for="{{ question_form.text.id_for_label }}" class="form-label text-white-75">{% trans "Your Question" %}: <span class="text-danger">*</span></label>
                {{ question_form.text }} {# Assumes widget has class="form-control" #}
                {% if question_form.text.errors %}<div class="invalid-feedback d-block">{{ question_form.text.errors|first }}</div>{% endif %}
                 <div class="invalid-feedback">{% trans "Please enter your question." %}</div>
            </div>

            {% if not user.is_authenticated or question_form.user_name_display %}
            <div class="mb-3">
                <label for="{{ question_form.user_name_display.id_for_label }}" class="form-label text-white-75">{% trans "Display Name (optional)" %}:</label>
                {{ question_form.user_name_display }}
                {% if question_form.user_name_display.errors %}<div class="invalid-feedback d-block">{{ question_form.user_name_display.errors|first }}</div>{% endif %}
            </div>
            {% endif %}
            <button type="submit" class="btn btn-warning">{% trans "Submit Question" %}</button>
        </form>
    </div>
</div> 